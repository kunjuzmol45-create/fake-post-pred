<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <title>Fake Job Post Prediction using Machine Learning</title>
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta content="" name="keywords">
        <meta content="" name="description">

        <!-- Google Web Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&family=Poppins:wght@200;300;400;500;600&display=swap" rel="stylesheet"> 

        <!-- Icon Font Stylesheet -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

        <!-- Libraries Stylesheet -->
        <link href="../static/lib/animate/animate.min.css" rel="stylesheet">
        <link href="../static/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

        <!-- Customized Bootstrap Stylesheet -->
        <link href="../static/css/bootstrap.min.css" rel="stylesheet">

        <!-- Template Stylesheet -->
        <link href="../static/css/style.css" rel="stylesheet">

        <style>
            .upload-section {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                padding: 60px 0;
                min-height: 600px;
            }

            .upload-card {
                background: white;
                border-radius: 15px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.1);
                padding: 50px;
                margin-top: 30px;
            }

            .upload-title {
                color: #333;
                margin-bottom: 30px;
                font-weight: 600;
            }

            .upload-zone {
                border: 3px dashed #667eea;
                border-radius: 10px;
                padding: 50px 20px;
                text-align: center;
                cursor: pointer;
                transition: all 0.3s ease;
                background: #f8f9ff;
            }

            .upload-zone:hover {
                border-color: #764ba2;
                background: #f0f2ff;
            }

            .upload-zone.dragover {
                border-color: #764ba2;
                background: #e8e9ff;
            }

            .upload-icon {
                font-size: 60px;
                color: #667eea;
                margin-bottom: 20px;
            }

            .upload-text {
                font-size: 18px;
                color: #333;
                margin-bottom: 10px;
                font-weight: 500;
            }

            .upload-hint {
                font-size: 14px;
                color: #666;
            }

            .file-input-hidden {
                display: none;
            }

            .image-preview {
                margin-top: 30px;
                text-align: center;
            }

            .preview-image {
                max-width: 100%;
                max-height: 400px;
                border-radius: 10px;
                margin-bottom: 20px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            }

            .btn-submit-image {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border: none;
                color: white;
                padding: 12px 40px;
                font-size: 16px;
                border-radius: 5px;
                transition: all 0.3s ease;
                margin-top: 20px;
            }

            .btn-submit-image:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
                color: white;
            }

            .btn-skip {
                background: #6c757d;
                border: none;
                color: white;
                padding: 12px 40px;
                font-size: 16px;
                border-radius: 5px;
                transition: all 0.3s ease;
                margin-top: 20px;
                margin-left: 10px;
            }

            .btn-skip:hover {
                background: #5a6268;
                color: white;
            }

            .info-box {
                background: #e8f4f8;
                border-left: 4px solid #667eea;
                padding: 20px;
                border-radius: 5px;
                margin-bottom: 30px;
            }

            .info-box h5 {
                color: #667eea;
                margin-bottom: 10px;
            }

            .info-box p {
                color: #555;
                margin: 0;
                font-size: 14px;
            }

            .result-box {
                background: white;
                border-radius: 10px;
                padding: 30px;
                margin-top: 30px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.1);
                display: none;
            }

            .result-box.show {
                display: block;
                animation: slideIn 0.5s ease-in-out;
            }

            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .prediction-badge {
                display: inline-block;
                padding: 15px 40px;
                border-radius: 50px;
                font-size: 24px;
                font-weight: 700;
                margin: 20px 0;
                color: white;
            }

            .prediction-badge.legitimate {
                background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            }

            .prediction-badge.fraudulent {
                background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            }

            .result-details {
                margin-top: 25px;
                border-top: 2px solid #eee;
                padding-top: 20px;
            }

            .detail-row {
                display: flex;
                justify-content: space-between;
                padding: 12px 0;
                border-bottom: 1px solid #f0f0f0;
            }

            .detail-label {
                font-weight: 600;
                color: #667eea;
            }

            .detail-value {
                color: #555;
            }

            .extracted-text-box {
                background: #f8f9fa;
                border-left: 4px solid #667eea;
                padding: 15px;
                border-radius: 5px;
                margin-top: 20px;
                max-height: 200px;
                overflow-y: auto;
            }

            .btn-new-analysis {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border: none;
                color: white;
                padding: 12px 30px;
                border-radius: 5px;
                margin-top: 20px;
                margin-right: 10px;
                transition: all 0.3s ease;
            }

            .btn-new-analysis:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
                color: white;
            }
        </style>
    </head>

    <body>

        <!-- Spinner Start -->
        <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
            <div class="spinner-border text-secondary" style="width: 3rem; height: 3rem;" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
        <!-- Spinner End -->

        <!-- Navbar & Hero Start -->
        <div class="container-fluid nav-bar p-0">
            <nav class="navbar navbar-expand-lg navbar-light bg-white px-4 px-lg-5 py-3 py-lg-0">
                <a href="" class="navbar-brand p-0">
                    <h1 class="display-5 text-secondary m-0">Fake Job Prediction</h1>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                    <span class="fa fa-bars"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <div class="navbar-nav ms-auto py-0">
                        <a href="{{url_for('index')}}" class="nav-item nav-link">Home</a>
                        <a href="{{url_for('upload_image')}}" class="nav-item nav-link active">Image Upload</a>
                        <a href="{{url_for('performance')}}" class="nav-item nav-link">Performance Analysis</a>
                        <a href="{{url_for('chart')}}" class="nav-item nav-link">Chart</a>
                        <a href="{{url_for('logout')}}" class="nav-item nav-link">Logout</a>
                    </div>
                </div>
            </nav>
        </div>
        <!-- Navbar & Hero End -->

        <!-- Header Start -->
        <div class="container-fluid bg-breadcrumb">
            <div class="container text-center py-5" style="max-width: 900px;">
                <h3 class="text-white display-3 mb-4 wow fadeInDown" data-wow-delay="0.1s">Upload Job Post</h3>
                <ol class="breadcrumb justify-content-center text-white mb-0 wow fadeInDown" data-wow-delay="0.3s">
                    <li class="breadcrumb-item text-secondary">Dashboard</li>
                    <li class="breadcrumb-item active text-secondary">Upload Image</li>
                </ol>    
            </div>
        </div>
        <!-- Header End -->

        <!-- Upload Section Start -->
        <div class="container-fluid upload-section">
            <div class="container" style="max-width: 700px;">
                <div class="upload-card wow fadeInUp" data-wow-delay="0.1s">
                    <h2 class="upload-title text-center">Upload Job Post Image</h2>
                    
                    <div class="info-box">
                        <h5><i class="bi bi-info-circle"></i> How it Works</h5>
                        <p>Upload an image of a job posting to analyze it for potential fraud. Our machine learning models will examine the content and provide a prediction on whether the job post is legitimate or fraudulent.</p>
                    </div>

                    <form id="uploadForm" enctype="multipart/form-data">
                        <div class="upload-zone" id="uploadZone">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <p class="upload-text">Drag and drop your job post image here</p>
                            <p class="upload-hint">or click to select a file</p>
                            <p class="upload-hint" style="margin-top: 10px; font-size: 12px;">Supported formats: JPG, PNG, GIF (Max 10MB)</p>
                        </div>
                        <input type="file" id="imageInput" name="image" class="file-input-hidden" accept="image/*">

                        <div class="image-preview" id="imagePreview" style="display: none;">
                            <img id="previewImg" class="preview-image" src="" alt="Preview">
                            <p id="fileName" style="color: #666; margin-bottom: 10px;"></p>
                            <button type="button" class="btn btn-danger btn-sm" id="removeImage">Remove Image</button>
                        </div>

                        <div class="text-center">
                            <button type="submit" class="btn btn-submit-image" id="submitBtn" disabled>
                                <i class="fas fa-check-circle"></i> Analyze Image
                            </button>
                            <a href="{{url_for('prediction')}}" class="btn btn-skip">
                                <i class="fas fa-arrow-right"></i> Skip to Prediction
                            </a>
                        </div>
                    </form>

                    <div id="loadingSpinner" style="display: none; text-align: center; margin-top: 30px;">
                        <div class="spinner-border text-primary" role="status">
                            <span class="sr-only">Uploading...</span>
                        </div>
                        <p style="margin-top: 15px; color: #667eea;">Processing your image with AI...</p>
                    </div>

                    <div id="uploadStatus" style="margin-top: 20px;"></div>

                    <!-- Prediction Result Box -->
                    <div id="resultBox" class="result-box">
                        <h3 style="color: #333; margin-bottom: 20px; text-align: center;">
                            <i class="fas fa-check-circle" style="color: #667eea;"></i> Analysis Complete
                        </h3>
                        
                        <div style="text-align: center;">
                            <p style="color: #666; font-size: 16px; margin-bottom: 15px;">Job Post Status:</p>
                            <div id="predictionBadge" class="prediction-badge"></div>
                        </div>

                        <div class="result-details">
                            <div class="detail-row">
                                <span class="detail-label"><i class="fas fa-brain"></i> Model Used:</span>
                                <span class="detail-value" id="modelUsed">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label"><i class="fas fa-chart-line"></i> Confidence:</span>
                                <span class="detail-value" id="confidenceLevel">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label"><i class="fas fa-image"></i> Image File:</span>
                                <span class="detail-value" id="imageFileName">-</span>
                            </div>
                        </div>

                        <div class="extracted-text-box">
                            <p style="color: #667eea; font-weight: 600; margin-bottom: 10px;">
                                <i class="fas fa-file-alt"></i> Extracted Text:
                            </p>
                            <p id="extractedText" style="color: #555; font-size: 13px; line-height: 1.6; margin: 0;"></p>
                        </div>

                        <!-- Explanation / Reasons -->
                        <div class="explanation-box" id="explanationBox" style="display:none; margin-top:16px;">
                            <p style="color: #e74c3c; font-weight: 600; margin-bottom: 8px;">
                                <i class="fas fa-exclamation-triangle"></i> Why we think this may be fraudulent
                            </p>
                            <p id="explanationText" style="color: #555; font-size: 13px; margin: 0;"></p>
                            <ul id="explanationList" style="margin-top:8px; color:#444; font-size:13px; display:none;"></ul>
                            <p style="color:#666; font-size:12px; margin-top:8px;">Tip: Do not share personal or financial information, and verify the employer independently.</p>
                        </div>

                        <div style="text-align: center;">
                            <button type="button" class="btn btn-new-analysis" id="newAnalysisBtn">
                                <i class="fas fa-redo-alt"></i> Analyze Another Image
                            </button>
                            <a href="{{url_for('prediction')}}" class="btn btn-skip">
                                <i class="fas fa-arrow-right"></i> Go to Advanced Prediction
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Upload Section End -->

        <!-- Footer Start -->
        <div class="container-fluid footer py-5 wow fadeIn" data-wow-delay="0.2s">
            <div class="container py-5">
                <div class="row g-5">
                    <div class="col-lg-3 col-md-6">
                        <h4 class="text-white mb-4">About Us</h4>
                        <p class="text-light mb-0">Fake Job Post Prediction system uses advanced machine learning to identify fraudulent job postings.</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Footer End -->

        <!-- JavaScript Libraries -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="../static/lib/wow/wow.min.js"></script>
        <script src="../static/lib/easing/easing.min.js"></script>
        <script src="../static/lib/waypoints/waypoints.min.js"></script>
        <script src="../static/lib/counterup/counterup.min.js"></script>
        <script src="../static/lib/owlcarousel/owl.carousel.min.js"></script>

        <!-- Template Javascript -->
        <script src="../static/js/main.js"></script>

        <script>
            const uploadZone = document.getElementById('uploadZone');
            const imageInput = document.getElementById('imageInput');
            const imagePreview = document.getElementById('imagePreview');
            const previewImg = document.getElementById('previewImg');
            const fileName = document.getElementById('fileName');
            const removeImageBtn = document.getElementById('removeImage');
            const submitBtn = document.getElementById('submitBtn');
            const uploadForm = document.getElementById('uploadForm');
            const uploadStatus = document.getElementById('uploadStatus');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const resultBox = document.getElementById('resultBox');
            const newAnalysisBtn = document.getElementById('newAnalysisBtn');

            // Click to upload
            uploadZone.addEventListener('click', () => {
                imageInput.click();
            });

            // File selection
            imageInput.addEventListener('change', handleFileSelect);

            // Drag and drop
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });

            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });

            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    imageInput.files = files;
                    handleFileSelect();
                }
            });

            function handleFileSelect() {
                const file = imageInput.files[0];
                if (file) {
                    // Validate file size (10MB max)
                    if (file.size > 10 * 1024 * 1024) {
                        showStatus('File size exceeds 10MB limit', 'danger');
                        imageInput.value = '';
                        return;
                    }

                    // Validate file type
                    if (!file.type.startsWith('image/')) {
                        showStatus('Please select a valid image file', 'danger');
                        imageInput.value = '';
                        return;
                    }

                    // Show preview
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        previewImg.src = e.target.result;
                        fileName.textContent = file.name;
                        imagePreview.style.display = 'block';
                        uploadZone.style.display = 'none';
                        submitBtn.disabled = false;
                        uploadStatus.innerHTML = '';
                        resultBox.classList.remove('show');
                    };
                    reader.readAsDataURL(file);
                }
            }

            removeImageBtn.addEventListener('click', () => {
                imageInput.value = '';
                imagePreview.style.display = 'none';
                uploadZone.style.display = 'block';
                submitBtn.disabled = true;
                uploadStatus.innerHTML = '';
                resultBox.classList.remove('show');
            });

            // New analysis button
            newAnalysisBtn.addEventListener('click', () => {
                imageInput.value = '';
                imagePreview.style.display = 'none';
                uploadZone.style.display = 'block';
                submitBtn.disabled = true;
                uploadStatus.innerHTML = '';
                resultBox.classList.remove('show');
            });

            // Form submission
            uploadForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const file = imageInput.files[0];
                if (!file) {
                    showStatus('Please select an image', 'warning');
                    return;
                }

                const formData = new FormData();
                formData.append('image', file);

                loadingSpinner.style.display = 'block';
                submitBtn.disabled = true;
                uploadStatus.innerHTML = '';
                resultBox.classList.remove('show');

                try {
                    const response = await fetch('{{ url_for("upload_image_process") }}', {
                        method: 'POST',
                        body: formData
                    });

                    const data = await response.json();
                    loadingSpinner.style.display = 'none';

                    if (data.success) {
                        displayPredictionResult(data);
                    } else {
                        showStatus(data.message || 'Upload failed', 'danger');
                        submitBtn.disabled = false;
                    }
                } catch (error) {
                    loadingSpinner.style.display = 'none';
                    showStatus('An error occurred: ' + error.message, 'danger');
                    submitBtn.disabled = false;
                }
            });

            function displayPredictionResult(data) {
                // Update result box with prediction data
                const predictionBadge = document.getElementById('predictionBadge');
                const modelUsed = document.getElementById('modelUsed');
                const confidenceLevel = document.getElementById('confidenceLevel');
                const imageFileName = document.getElementById('imageFileName');
                const extractedText = document.getElementById('extractedText');
                const explanationBox = document.getElementById('explanationBox');
                const explanationText = document.getElementById('explanationText');

                // Set prediction badge
                const prediction = data.prediction;
                predictionBadge.textContent = prediction.toUpperCase();
                predictionBadge.className = 'prediction-badge ' + (prediction === 'Legitimate' ? 'legitimate' : 'fraudulent');

                // Set other details
                modelUsed.textContent = data.model_used || 'Unknown';
                confidenceLevel.textContent = data.confidence || 'High';
                imageFileName.textContent = data.filename || 'Unknown';
                extractedText.textContent = data.extracted_text || 'No text extracted';

                // Show explanation if available and the post is fraudulent
                const explanation = data.explanation || '';
                const featureList = document.getElementById('explanationList');
                if (explanation && data.prediction === 'Fraudulent') {
                    explanationText.textContent = explanation;
                    explanationBox.style.display = 'block';

                    // populate detailed feature explanations if provided
                    const feats = data.feature_explanations || [];
                    if (feats.length) {
                        featureList.innerHTML = '';
                        feats.forEach(f => {
                            const li = document.createElement('li');
                            li.textContent = `${f.feature} â€” ${f.score}`;
                            featureList.appendChild(li);
                        });
                        featureList.style.display = 'block';
                    } else {
                        featureList.style.display = 'none';
                        featureList.innerHTML = '';
                    }
                } else {
                    explanationText.textContent = '';
                    explanationBox.style.display = 'none';
                    featureList.style.display = 'none';
                    featureList.innerHTML = '';
                }

                // Show result box
                resultBox.classList.add('show');
                
                // Scroll to results
                resultBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }

            function showStatus(message, type) {
                uploadStatus.innerHTML = `<div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>`;
            }
        </script>
    </body>

</html>
